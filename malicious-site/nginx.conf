server {
    listen                  443 ssl;
    listen                  [::]:443 ssl;
    server_name             localhost;
    ssl_certificate         /root/ssl/cert.pem;
    ssl_certificate_key     /root/ssl/key.pem;

    root /var/www/html;
    index index.php index.html;

    location / {
        try_files $uri $uri/ =404;
    }
    
    # Process PHP files
    location ~ \.php$ {
        fastcgi_pass php-fpm:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    
    # SQL Injection simulation endpoint
    location ~ ^/user/(.+)$ {
        return 200 "User ID: $1";
        add_header Content-Type text/plain;
    }
    
    # Command Injection simulation endpoint
    location ~ ^/cmd/(.*)$ {
        return 200 "Command Executed: $1";
        add_header Content-Type text/plain;
    }
    
    # Path Traversal simulation endpoint
    location ~ ^/include/(.*)$ {
        return 200 "File Included: $1";
        add_header Content-Type text/plain;
    }
    
    # Malicious file downloads
    location = /download/malware.exe {
        alias /var/www/html/eicar.com;
        add_header Content-Disposition "attachment; filename=malware.exe";
        add_header Content-Type application/octet-stream;
    }
    
    location = /download/backdoor.php {
        alias /var/www/html/backdoor.php;
        add_header Content-Type text/plain;
    }
    
    # EICAR test file direct access
    location = /eicar.com {
        alias /var/www/html/eicar.com;
        add_header Content-Type application/octet-stream;
    }
    
    # JavaScript files
    location ~ \.js$ {
        try_files $uri =404;
    }
}

server {
    listen 80;
    listen [::]:80;
    server_name localhost;
    
    root /var/www/html;
    index index.php index.html;
    
    # Enable all the same locations for HTTP
    location / {
        try_files $uri $uri/ =404;
    }
    
    # Process PHP files
    location ~ \.php$ {
        fastcgi_pass php-fpm:9000;
        fastcgi_index index.php;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }
    
    # SQL Injection simulation endpoint
    location ~ ^/user/(.+)$ {
        return 200 "User ID: $1";
        add_header Content-Type text/plain;
    }
    
    # Command Injection simulation endpoint
    location ~ ^/cmd/(.*)$ {
        return 200 "Command Executed: $1";
        add_header Content-Type text/plain;
    }
    
    # Path Traversal simulation endpoint
    location ~ ^/include/(.*)$ {
        return 200 "File Included: $1";
        add_header Content-Type text/plain;
    }
    
    # Malicious file downloads
    location = /download/malware.exe {
        alias /var/www/html/eicar.com;
        add_header Content-Disposition "attachment; filename=malware.exe";
        add_header Content-Type application/octet-stream;
    }
    
    # EICAR test file direct access
    location = /eicar.com {
        alias /var/www/html/eicar.com;
        add_header Content-Type application/octet-stream;
    }
    
    # JavaScript files
    location ~ \.js$ {
        try_files $uri =404;
    }
}
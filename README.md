# Simple NGINX Test with Docker-Compose
This is a very simple NGINX web server using Docker with a self-signed certificate. The idea behind this repo was a very quick and portable way to test out load balancing on Ubuntu Server instances.

## Prerequisites

### Installing Docker and Docker Compose

Before running this project, you'll need to install Docker and Docker Compose on your Ubuntu system.

If you don't want to use Docker, use the instructions below for a native system install.

#### For Ubuntu Server:

1. Install Docker Engine:
```bash
# Uninstall old versions (if any)
sudo apt-get remove docker docker-engine docker.io containerd runc

# Update the apt package index
sudo apt-get update

# Install prerequisites
sudo apt-get install -y ca-certificates curl gnupg

# Add Docker's official GPG key
sudo install -m 0755 -d /etc/apt/keyrings
curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg
sudo chmod a+r /etc/apt/keyrings/docker.gpg

# Set up the repository
echo \
  "deb [arch="$(dpkg --print-architecture)" signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  "$(. /etc/os-release && echo "$VERSION_CODENAME")" stable" | \
  sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

# Update the apt package index again
sudo apt-get update

# Install Docker Engine, containerd, and Docker Compose
sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# Add your user to the docker group to run Docker without sudo
sudo usermod -aG docker $USER
# Log out and log back in for this to take effect
```

2. Docker Compose is now included as a Docker plugin and can be used with:
```bash
docker compose version
```

### Verify Docker Installation

To verify that Docker is installed correctly, run:
```bash
docker --version
docker compose --version
```

## Setting Up the NGINX Server

### 1. Create a Self-Signed Certificate
```bash
sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout ./key.pem \
  -out ./cert.pem
```

When prompted, enter appropriate information for your self-signed certificate. For local testing, the defaults are generally acceptable.

### 2. Start the NGINX Server
```bash
docker-compose up -d
```

This command will:
- Pull the NGINX Docker image if it's not already available locally
- Create and start the container with the configuration specified in the docker-compose.yml file
- Run the container in detached mode (-d flag) so it runs in the background

### 3. Access the Website
- HTTP (redirects to HTTPS): http://localhost
- HTTPS: https://localhost

Note: Since you're using a self-signed certificate, your browser will show a security warning. This is expected and can be bypassed for local testing.

### 4. Stop the Server
```bash
docker-compose down
```

## Project Structure
- `docker-compose.yml`: Defines the NGINX service configuration
- `nginx.conf`: NGINX server configuration with SSL settings
- `index.html`: Simple web page served by NGINX
- `key.pem` & `cert.pem`: SSL certificate files (generated by you)

## Troubleshooting
- If ports 80 or 443 are already in use, modify the port mappings in the docker-compose.yml file.
- Ensure that Docker is running before executing docker-compose commands.
- If you encounter permission issues creating the certificates, try running the commands without sudo (on macOS) or use an administrator command prompt (on Windows).

# Native System Install

If you prefer not to use Docker, you can install NGINX directly on your Ubuntu Server:

1. **Install NGINX**:
   ```bash
   sudo apt update
   sudo apt install -y nginx
   ```

2. **Generate a Self-Signed Certificate**:
   ```bash
   sudo mkdir -p /etc/nginx/ssl
   
   sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
     -keyout /etc/nginx/ssl/key.pem \
     -out /etc/nginx/ssl/cert.pem
   ```

3. **Configure NGINX**:
   Create a new site configuration:
   ```bash
   sudo nano /etc/nginx/sites-available/example
   ```
   
   Paste the following configuration:
   ```
   server { 
       listen                  443 ssl;
       listen                  [::]:443 ssl;
       server_name             localhost;
       ssl_certificate         /etc/nginx/ssl/cert.pem;
       ssl_certificate_key     /etc/nginx/ssl/key.pem;

       root /var/www/html;
       index index.html;

       location / {
         try_files $uri $uri/ =404;
       }
   }
   server {
       listen 80;
       listen [::]:80;

       server_name localhost;

       return 302 https://$server_name$request_uri;
   }
   ```

4. **Create a Symbolic Link to Enable the Site**:
   ```bash
   sudo ln -s /etc/nginx/sites-available/example /etc/nginx/sites-enabled/
   ```

5. **Copy the Website Content**:
   ```bash
   # Copy index.html to the web root
   sudo cp /path/to/repo/index.html /var/www/html/
   ```

6. **Test NGINX Configuration**:
   ```bash
   sudo nginx -t
   ```

7. **Restart NGINX**:
   ```bash
   sudo systemctl restart nginx
   ```

8. **Access the Website**:
   - HTTP (redirects to HTTPS): http://localhost
   - HTTPS: https://localhost

9. **Control NGINX Service**:
   ```bash
   # Stop NGINX
   sudo systemctl stop nginx
   
   # Start NGINX
   sudo systemctl start nginx
   
   # Check status
   sudo systemctl status nginx
   ```

## Troubleshooting Native Installation (Ubuntu Server)

- **Port conflicts**: If ports 80 or 443 are already in use, you may need to change them in the NGINX configuration.
- **Permission issues**: Make sure you have proper permissions to write to the configuration directories.
- **Certificate errors**: Ensure the paths to your SSL certificates are correct in the NGINX configuration.
- **Service doesn't start**: Check the NGINX error logs for more information.
